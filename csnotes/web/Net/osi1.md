# OSI-计算机网络体系结构
## 计算机网络概述
### 计算机网络的概念

1. 广义观点：能实现远程信息处理的系统，或进一步能达到资源共享的系统，都是计算机网络。它在物理结构上具有计算机网络模型，是网络发展的初级阶段。
2. 资源共享观点：计算机网络是“已能够相互共享资源的方式联合起来的自治计算机系统的集合”。其中包含三重含义：
    1. 目的：资源共享；
    2. 组成单元：分布在不同地理位置的多台独立的“自治计算机”；
    3. 网络中的计算机必须遵循统一规则——网络协议。
3. 用户透明性观点：存在着一个能为用户自动管理资源的网络操作系统，它能够调用用户所需用的资源，整个网络像一个大的计算机系统一样对用户是透明的。这种定义描述了一个分布式系统，它是网络的未来发展趋势。

### 计算机网络的组成
1. 从组成部分来看：硬件（主机，通信链路，交换设备，通信处理机），软件（实现资源共享的软件，多数处在应用层），协议（计算机网络的核心，规定了网络传输数据所遵守的规范）。
2. 从工作方式来看：边缘部分（连接在网络上、供用户使用的主机），核心部分（大量的网络与连接它们的路由器）。
3. 从功能组成来看：通信子网（传输介质、通信设备和相关网络协议），资源子网（实现资源共享功能的设备及其软件的集合）。

### 计算机网络的功能
1. 数据通信：最基本、最重要的功能。
2. 资源共享：可以是软件共享，也可以是硬件共享。
3. 分布式处理：充分利用空闲资源，提高整个系统的资源利用率。
4. 提高可靠性：计算机网络中的各台机器可以通过网络互为替代机。
5. 负载均衡：将工作任务均衡地分配给计算机网络中的各台机器。

### 计算机网络的分类
1. 按分布范围分类：
    1. 广域网（WAN）：因特网的核心部分，提供长距离通信，覆盖范围为几十到几千千米，有时也称作远程网，传统使用交换技术。
    2. 城域网（MAN）：覆盖5~50km，多使用以太网技术，因此有时也并入局域网范围进行讨论。
    3. 局域网（LAN）：几十米到几千米，传统使用广播技术。
    4. 个人区域网（PAN）：使用无线技术连接则为WPAN，范围约10m。
    >注：若中央处理器之间的距离非常近（<1m），则一般称作多处理器系统，而非计算机网络。
2. 按传输技术分类：
    1. 广播式网络
    2. 点对点网络
3. 按拓扑结构分类：
    1. 星型网络：早期网络模型，成本高，中心节点对故障敏感。
    2. 总线型网络：建站容易、增减方便、节省线路，但负载重时通信效率低、总线任一处故障敏感。
    3. 环形网络：可以是单环或双环，环中信号单向传输。
    4. 网状形网络：每个结点至少有两条路径与其它结点相连，多用在广域网中，可靠性高，但控制复杂、线路成本高。
4. 按使用者分类：
    1. 公用网（Public Network）：指电信公司出资建造的大型网络，凡缴费的都可以接入，也称作公众网。
    2. 专用网（Private Network）：某部门为本单位业务需要而建造的网络，如铁路、电力、军队等部门的专用网。
5. 按交换技术分类：
    1. 电路交换网络：在源结点和目的结点之间建立一条专用数据通路，最典型的为传统电话网络。直接传输，延时小，但线路利用率低、不便差错控制。
    2. 报文交换系统：将用户数据加上源地址、目的地址、校验码等辅助信息，然后封装成报文。整个报文传送到相邻结点，全部储存下来后再转发，之后重复直到达到目的结点。也称作存储-转发网络。
    3. 分组交换网络：也称作包交换网络，其原理是将数据分成较短的固定长度的数据块，在每个数据块中加上目的地址、源地址等辅助信息组成分组（包），以存储-转发的方式传输。此为现在主流网络模型。
6. 按传输介质分类：
    1. 有线网络：双绞线网络、同轴线网络、光纤网络等。
    2. 无线网络：蓝牙网络、微波网络、无线电网络等。

### 计算机网络的标准化工作及相关组织
因特网所有标准都以 RFC (Request For Comments) 的形式在因特网 上发布。其升为因特网正式标准需要经历以下四个阶段：
1. 因特网草案（Internet Draft）：此阶段还不是 RFC 文档；
2. 建议标准（Rroposed Standard）：从此阶段开始成为 RFC 文档；
3. 草案标准（Draft Standard）；
4. 因特网标准（Internet Standard）。

负责制定、实施相关网络标准的标准化组织有：
1. ISO（国际标准化组织）：制定的主要网络标准或规范有 OSI 参考模型、HDLC 等；
2. ITU（国际电信联盟）：前身为 CCITT（国际电话电报咨询委员会），其下属机构 ITU-T 制定了大量有关远程通信的标准；
3. IEEE（国际电气电子工程师协会）：世界上最大的专业技术群体，由计算机和工程学专业人士组成。在通信领域最著名的成果为 802 标准。

### 计算机网络的性能指标
1. 带宽（Bandwidth）：本来表示通信线路允许的信号频带范围，单位为赫兹（Hz）。在计算机网络中表示网络通信线路传输数据的能力，是数字信道所能传送的“最高数据率”的同义词，单位为“比特每秒（b/s）”。
2. 时延（Delay）：指数据（一个报文或一个分组）从网络（或链路）的一端传送到另一端所需要的总时间，由四部分组成，总时延为四者之和：
    1. 发送时延：从发送分组第一个比特开始，到最后一个比特结束，发送完毕所需要的总时间，也称作传输时延。计算公式为： `发送时延 = 分组长度/信道宽度`
    2. 传播时延：一个比特从链路一端到另一端传播所需时间。计算公式为： `传播延时 = 信道长度/电磁波在信道上的传输速度`
    3. 处理时延：数据在交换节点为存储转发而进行的一些必要处理所花费的时间；
    4. 排队时延：分组进入路由器后要现在输入队列中排队等待处理，以及在输出队列中排队等待转发。
3. 时延带宽积：即在信道满载时存留在信道中的总数据比特数： ` 时延带宽积 = 传播时延 * 信道带宽 `

4. 往返时延（Round-Trip Time, RTT）：表示从发送端开始发送数据到接收到来自接收端的确认（假设接收端收到数据后立即发送确认），总经历的时延。其中包括了处理时延、排队时延以及转发数据时的发送时延。
5. 吞吐量（Throughput）：表示单位时间内通过某个网络（或信道、接口）的数据量。吞吐量受网络带宽或网络额定速率的限制。
6. 速率（Speed）：也称作数据率或比特率，单位是 b/s （比特每秒），可写作 bit/s 或 bps 。另外也有 Kb/s（K = 10^3）、Mb/s（M = 10^6）、Gb/s（G = 10^9）。在计算机网络中，通常将最高数据率成为“带宽”。

## 计算机网络体系结构与参考模型
### 计算机网络分层结构
我们把计算机网络的各层及其协议的集合成为网络的体系结构（Architecture）。其中的功能如何实现，则是遵循这种体系结构的实现（Implementation）问题。我们将大系统分成较易实现的若干层次，分层的基本原则为：

1. 每一层都实现一种相对独立的功能，降低大系统的复杂度；
2. 各层之间界面自然清晰，易于理解，相互交流尽可能少；
3. 各层功能的精确定义独立于具体实现的方法，可以使用最合适的技术来实现；
4. 保持下层对上层的独立性，上层单向使用下层提供的服务；
5. 整个分层工作应能促进标准化工作。

在计算机网络的分层结构中，第 n 层中的活动元素通常称为 n 层实体。具体的，**实体**指任何可发送或接收信息的硬件或软件进程，通常是一个特定的软件模块。不同机器上的同一层成为对等层，同一层的实体叫做对等实体。n 层为服务提供者，n+1 层为服务用户。

在各个层次中，每个报文都分为两个部分：数据部分（SDU） + 控制信息部分（PCI），它们共同组成 PDU：
1. SDU（服务数据单元）：为完成用户所要求的功能而应传送的数据；
2. PCI（协议控制信息）：控制协议操作的信息；
3. PDU（协议数据单元）：对等层次之间传送的数据单位。每层的协议数据单元都有通俗名称，如物理层的 PDU 叫比特，链路层的 PDU 叫帧，网络层的 PDU 叫分组，传输层的 PDU 叫 报文。

层次结构的含义包括：

1. 第 n 层的实体不仅要使用 n-1 层的服务，实现自身定义的功能，还要向第 n+1 层提供本层的服务，该服务是第 n 层及其下面各层提供的服务总和。
2. 最底层只提供服务，是整个层次结构的基础；中间各层既是下一层的服务使用者，又是上一层的服务提供者；最高层面向用户提供服务。
3. 上一层只能通过相邻层的接口使用下一层的服务，而不能调用其他层的服务；下一层所提供服务的实现细节对上一层透明。
4. 两个主机通信时，对等层在逻辑上有一条直接信道，表现为不经过下层就把信息直接传送到对方。

### 计算机协议、接口、服务的概念
1. 协议：就是规则的集合。网络协议（Network Protocol）是控制两个（或多个）对等实体进行通信的规则的集合也就是水平的。不对等实体之间是没有协议的。一个完整的协议应该有线路管理（建立、释放连接）、差错控制、数据转换等功能。协议分三部分组成：
    1. 语法：规定了传输数据的格式；
    2. 语义：规定了所要完成的功能，即需要发出何种控制信息、完成何种动作以及做出何等应答；
    3. 同步：规定了执行各种操作的条件、时序关系等。
2. 接口：同一结点内相邻两层间交换信息的连接点，是一个系统内部的规定。每一层只能为紧邻的层次之间定义接口，不能跨层定义接口。在典型的接口上，同一结点相邻的两层实体通过服务访问（Service Access Point, SAP）进行交互，它实际上是一个逻辑接口。
3. 服务：指下层为紧相邻的上层提供的功能调用，也就是垂直的。上层使用下层服务必须与下次交换一些命令，这些命令在 OSI 中成为服务原语，分为四类：
    1. 请求（Request）：由服务用户发往服务提供者，请求完成某项工作；
    2. 指示（Indication）：由服务提供者发往服务用户，指示用户做某件事；
    3. 响应（Response）：由服务用户发往服务提供者，作为对指示的响应；
    4. 证实（Conformation）：由服务提供者发往服务用户，作为对请求的证实。

```mermaid
graph LR;
a(端系统A n+1层)-->|请求|b(端系统A n层);
b-->|证实|a;
b-.-d;
d-.-b;
c(端系统B n+1层)-->|响应|d(端系统B n层);
d-->|指示|c;
```

计算机网络提供的服务可以按以下三种方式进行分类：

1. 面向连接服务与无连接服务
2. 可靠服务与不可靠服务
3. 有应答服务与无应答服务

### ISO/OSI 参考模型和 TCP/IP 协议

#### OSI 参考模型
即 **开放互联网参考模型**（OSI/RM）：

![osi1.png](/Net/osi1.png)


传输内容|OSI划分|设备|简介|内容示例|协议标准示例
---|---|---|---|---|---
应用信息|应用层 表示层 会话层||该层为用户提供所需的各种服务，是用户与网络的接口|Hello（高层数据）|FTP、HTTP、SMTP、POP3、DNS
段|传输层||该层向高层屏蔽了下层数据通信的细节，使用户看到的只是在两个传输实体间的一条从主机到主机的、可由用户控制和设定的、可靠的数据通路，为端到端连接提供流量控制、差错控制、服务质量、数据传输管理等服务|TCP/UDP头 + &上|TCP、UDP
数据报|网络层|路由器|把网络层的协议数据单元（分组）从源端传到目的端。关键是对分组进行路由选择，实现流量控制、拥塞控制、差错控制和网际互连等|IP包头 + &上|IP、IPX、ICMP、IGMP、ARP、RARP、OSPF
帧|数据链路层|交换机|解决了点到点的通信问题。该层负责网卡设备的驱动，成帧、差错控制、流量控制和传输管理等工作|LLC子层 + &上  MAC子层 + &上 + FCS|SDLC、HDLC、PPP、STP、帧中继
比特|物理层|网线 调制解调器|主要是通过传输介质发送和接收二进制比特流，因此有人将其称作第0层|数字信号|EIA-232C、EIA/TIA RS-449、CCITT 的 X.21

其中应用层、表示层、会话层属于资源子网，网络层、数据链路层、物理层属于通信子网，运输层起承上启下的作用。

1. 物理层（Physical Layer）：物理层主要研究以下内容：
    1. 通信链路与通信结点进行连接的接口的机械参数；
    2. 通信链路上传输信号的意义与电气特性。
2. 数据链路层（Data Link Layer）：数据帧中包含物理地址（MAC）、控制码、数据及校验码等信息，通过校验、确认、反馈转发等手段，把不可靠的物理链路转换为对网络层来说无差错的链路。广播式网络在数据链路层中还要控制对共享信道的访问，为此该层还有一个特殊子层——介质访问子层。
3. 网络层（Network Layer）：因特网主要的网络层协议是无连接的网际协议（Internet Protocol, IP）和许多路由选择协议，因此因特网的网络层也叫做网际层或 IP 层。数据包从源到目的地，往往要经过十几台路由器（Router）。IP协议并不能保证数据传输的可靠性，数据包在传输过程中可能丢失。注意：TCP/IP协议中，是IP负责数据的传输，而TCP负责数据的可靠性。
4. 传输层（Transport Layer）：也叫运输层，提供端到端的通信服务，而数据链路层提供的是点到点的通信服务。点到点可以理解为主机到主机的硬件地址或 IP 地址的通信，端到端则是不同主机内两个进程之间的通信，通过端口进行标识。
5. 会话层（Session Layer）：允许不同主机上个进程之间的会话。会话层负责管理主机之间的会话进程，包括建立、管理以及终止进程间的会话。会话层使用校验点可使通信会话在通信失效时从校验点恢复通信，实现数据同步。
6. 表示层（Presentation Layer）：表示层主要用于处理两个通信系统中交换信息的不同表示方式，如编码格式、数据结构定义、数据压缩、加密和解密等。
7. 应用层（Application Layer）:应用层是用户与网络的界面，为特定类型的网络应用提供访问 OSI 环境的手段。这是最复杂的一层。

更多协议：

![osi2.png](/Net/osi2.png)


#### TCP/IP 模型

层级名称|所对应的 OSI 参考模型
---|---
应用层|会话层、表示层、应用层
传输层|传输层
网际层|网络层
网络接口层|物理层、数据链路层


#### TCP/IP 模型与 OSI 参考模型的比较

相似之处：

1. 都采取分层的体系结构；
2. 基于独立的协议栈概念；
3. 都可以解决异构网络的互联，实现不同厂商生产的计算机之间的通信。

差别：

1. OSI 精确定义了三个主要概念：服务、协议和端口，符合现代软件工程的设计思想；
2. OSI 参考模型先于协议产生，通用性良好，TCP/IP 则是先有协议、再对协议进行模型描述；
3. TCP/IP 在设计之初就旨在解决异构网络互连的问题，并将网际协议 IP 作为一个单独的重要层次。OSI 参考模型开始只考虑到用一种标准的公用数据网将各种不同的系统互联。后来才在网络层中划分了实现 IP 功能的子层；
4. OSI 参考模型在网络层支持无连接和面向连接的通信，但在传输层只有面向连接的通信。而 TCP/IP 模型认为可靠性是端到端的问题，因此它在网际层仅有一种无连接的通信模式，但在传输层支持面向连接和无连接两种模式。