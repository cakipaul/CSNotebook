# OSI-物理层
## 通信基础
### 基本概念
1. 数据、信号与码元
    - 数据：传送信息的实体；
    - 信号：数据的电气或电磁表现，是数据在传输过程中的存在形式。其中连续变化的数据称作模拟信号，取值仅允许为有限的几个离散数值的数据成为数字信号；
    - 码元：指用一个固定时长的信号波形（数字信号），表示一位 k 进制数字，代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为 k 进制码元，而该时长称为码元的宽度。1 码元可以携带多个比特的信息量。

2. 信源、信道与信宿
    - 信源：产生和发送数据的源头；
    - 信宿：接收数据的终点，通常是计算机或其他数字终端装置；
    - 信道：与电路并不等同，信道是信息的传输媒介，一个信道可以看成是一条线路的逻辑部件，一条通信线路通常包含一条发送信道和一条接收信道：
        - 基带信号与宽带信号：基带信号是将数字 0 和 1 直接用两种不同的电压表示，然后送到数字信道上去传输（称为基带传输），常用于局域网；宽带信号是将基带信号进行调制后形成频分复用的模拟信号，然后传送到模拟信道上去传输（称为宽带传输）；
        - 单工/半双工/全双工通信：只有一个方向、仅需要一条信道/需要两条信道、都可以收发信息（但不能同时）/需要两条信道、可以同时收发信息；
        - 信道的极限容量：信道的最高码元传输速率或信道的极限信息传输速率。

3. 速率、波特与带宽
    - 速率：也叫数据率，指数据的传输速率，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示：
        - 码元传输速率：又称码元速率、波形速率、调制速率、符号速率，表示单位时间内数字通信系统所传输的码元个数，单位是波特（Baud），码元速率与进制数无关；
        - 信息传输速率：又称信息速率、比特率，表示单位时间内数字通信系统传输的二进制码元个数（比特数），单位是比特每秒（b/s）。
    - 带宽：原是指信号具有的频带宽度（Hz），在实际网络中用来表示网络中两点间的“最高数据率”，单位为 b/s 。

### 奈奎斯特定理与香农定理
1. 奈奎斯特定理：又称奈氏准则，它指出在理想低通（无噪声、带宽有限）的信道中，极限码元传输率为 2W Baud 。其中 W 是理想低通信道的带宽，单位为 Hz 。若用 V 表示每个码元的离散电平数（即码元种数），则极限数据率为： 
    
    $$ \text{理想低通条件下的极限数据传输率} = 2Wlog_2V $$ 
    
    由此可以得到结论：

    - 在任何信道中，码元传输的速率是有上限的，若超过此上线，会出现严重的码间串扰问题；
    - 信道的频带越宽（即能通过的信号高频分量越多），就可以用更高的速率进行码元的有效传输；
    - 奈氏准则给出了码元传输速率的限制，但并没有对信息传输速率给出限制，也就是说没有对一个码元可以对应多少个二进制位做出限制。

    奈氏准则又被称作采样定理：假设原始信号中的最大频率为 f ，那么采样频率必须大于等于最大频率 f 的两倍才可以。

2. 香农（Shannon）定理：香农定理给出了带宽受阻且有高斯白噪声干扰的信道的极限数据传输速率：

    $$ \text{信道的极限数据传输率} = Wlog_2(1 + \frac{S}{N}) $$ 
    
    其中 W 为信道的带宽，S 为信道所传信号的平均功率，N 为信道内高斯噪声功率。S/N 即信噪比，值为 10lg(S/N) ，单位 dB 。S/N = 10 时，信噪比为 10dB ，而 S/N = 1000 时，信噪比为 30 dB 。

### 编码与调制
把数据变为模拟信号的过程称为调制，把数据变换为数字信号的过程称为编码。

#### 数字数据编码为数字信号
![数据编码](/Net/数据编码.jpg)

1. 非归零码（NZR）：用两个电压表示两个二进制数字，容易实现但没有检错功能，也没法判断码元起始与结束位置，难以同步；
2. 曼彻斯特编码（Manchester Encoding）：以太网的编码方式，将一个码元分成两个相等间隔，前高后低为 1，反之为 0.中间跳变可用于时钟同步，但所占频带宽度是原始基带宽度的两倍；
3. 差分曼彻斯特编码：常用于局域网传输，若码元为 1，则前半个码元的电平与上一个码元后半个码元的电平相同，若为 0 则相反。可以实现自同步，且抗干扰性良好；
4. 4B/5B 编码：将欲发送的数据流的每 4 位作为一组，按照 4B/5B 的规则将其转换成相应的 5 位码，共 32 种组合，但只采取其中的 16 种对应 16 种不同的 4 位码，其余 16 种作为控制码（帧的开始或结束、线路状态信息等）或保留。

#### 数字数据调制为模拟信号
调制解调器的调制与解调过程。基本调制方法有：

![数据调制](/Net/数据调制.jpg)

1. 幅移键控（ASK）：通过改变载波信号的振幅来实现，容易实现，但抗干扰能力差；
2. 频移键控（FSK）：通过改变载波信号频率来实现，容易实现，抗干扰能力强，应用广泛；
3. 相移键控（PSK）：通过改变载波信号的相位来实现，分为绝对调相和相对调相；
4. 正交振幅调制（QAM）：将 ASK 与 PSK 相结合，若波特率为 B，采用 m 个相位，n 种振幅，则传输速率 R 为：

$$R = B log_2( m*n )$$

#### 模拟数据编码为数字信号
最典型的例子为对音频信号进行编码的脉码调制（PCM），主要包含三个步骤：

1. 抽样：对模拟信号进行周期性扫描，将时间上连续的信号变为时间上离散的信号；
2. 量化：将电平幅值按照一定的分级标度转化为对应的数字值，并取整；
3. 编码：把量化的结果转换为对应的二进制编码。

#### 模拟数据调制为模拟信号
这种调制方式可以使用频分复用（FDM）技术，充分利用带宽资源。。

### 电路交换、报文交换与分组交换

![三种数据交换方式](/Net/三种数据交换方式.jpg)

1. 电路交换：两节点间使用专门的物理路径进行连接，分为连接建立、数据传输和连接释放三个阶段。其延时小，实现简单且稳定，但是浪费带宽资源，并且难以规格化；
2. 报文交换：数据交换的单位为报文，报文携带目的地址、源地址信息。报文在交换地点采取**存储转发**的传输方式。它不需要建立连接，可以动态分配线路，可靠且线路利用率高。但是由于报文大小没有限制，其时延难以控制，并且需要网络节点提供较大的缓存空间；
3. 分组交换：采取存储转发技术，解决了报文交换中每组数据块大小上限的问题。其中数据块添加了源地址、目的地址与分组编号信息等必要的控制信息，构成分组。

### 数据报与虚电路
分组交换是根据其通信子网向端点系统提供的服务，还可以进一步分为面向连接的虚电路连接方式和无连接的数据报方式。这两种方式都由网络层提供。

1. 数据报：端系统的高层先把报文拆成若干个带有序号的数据单元，并在网络层加上地址等控制信息后形成数据报分组（即网络层 PDU ）。中间节点存储分组一段很短的时间，找到最佳路由后尽快转发分组。不同分组可能走不同路径。
    
    ![数据报](/Net/数据报.jpg)

2. 虚电路：在分组发送前，要求在发送方和接收方之间建立一条逻辑上相连的虚电路，并且一旦建立连接，其物理路径也固定了。整个通信过程分为三个阶段：虚电路建立、数据传输和虚电路释放。
    
    ![虚电路](/Net/虚电路.jpg)

数据报服务和虚电路服务的比较：

—|数据报服务|虚电路服务
--|--|--
连接的建立|不要|必须有
目的地址|每个分组都有完整地址|仅在建立连接时使用，之后每个分组使用长度较短的虚电路号
路由选择|每个分组独立进行，路由选择和转发|属于同一条虚电路的分组按照同一路由转发
分组顺序|不保证分组有序到达|保证分组有序到达
可靠性|不保证通信可靠性，可靠性由用户主机来保证|可靠性由网络来保证
对网络故障的适应性|出故障的节点丢失分组，其他分组路径选择发生变化，可正常传输|所有经过故障结点的虚电路均不能正常工作
差错处理和流量控制|由用户主机进行流量控制，不保证数据报的可靠性|可由分组网络负责，也可由用户主机负责

## 传输介质
### 双绞线、同轴电缆、光纤和无线传输介质
传输介质也称作传输媒体，是发射设备和接收设备之间的物理通路，分为导向传输介质和非导向传输介质。

1. 双绞线：价格便宜，在局域网和传统电话网络中普遍使用，通信距离一般为几公里到数十公里。距离太远时，模拟信号需要放大器放大，数字信号需要中继器整形；
2. 同轴电缆：一般分为 50Ω 同轴电缆和 75Ω 同轴电缆。其中前者主要用于传输基带数字信号，又称基带同轴电缆，在局域网中广泛使用；后者主要用于传输宽带信号，又称宽带同轴电缆，主要用于有限电视系统。它具有良好的抗干扰性，价格较高，传输距离远
3. 光纤：光纤通信系统带宽范围极大。一根光导纤维（光纤）中可以存在多条不同入射角入射的光线，这种光纤称为**多模光纤**，其发光源为发光二极管。但由于失真现象，只适用于近距离传输。若光线直径减小到只有一个光的波长，则光纤就像一根波导，其中不会发生多次反射，这样的光线就是**单模光纤**。其光源为定向性很好的激光二极管，其衰耗较小，适合远距离传输；
4. 无线传输介质：普遍应用为蜂窝式无线电话网。
    1. 无线电波：接收设备无需正对发射方，大大简化了通信连接。如无线局域网（WLAN）；
    2. 微波、红外线和激光：三者都有很强的方向性，有时统称三者为视线介质。微波频率高、频段范围宽，载波频率通常为 2~40 GHz，数据传输率可达数兆比特每秒，其在地面传输需要中继站来接力。卫星通信容量大、距离远、覆盖广，但传播延时长，一般在 250~270ms。

### 物理接口的特性
1. 机械特性：规格、引线数目、引脚数、排列情况等；
2. 电气特性：信号电压、阻抗匹配、传输速率和距离限制等；
3. 功能特性：定义电平意义、信号线用途等；
4. 规程特性：主要定义各条物理线路的工作规程和时序关系。

常用物理接口标准有 EIA RS-232-C、ADSL 和 SONET/SDH 等。

## 物理层设备
### 中继器
中继器又称转发器，主要将信号整形放大，是局域网环境下扩大网络规模最简单廉价的互联设备，由中继器连接的几个网段仍是一个局域网。由于中继器工作在物理层，所以它不能连接两个具有不同速率的局域网。中继器理论上可以无限串联，实际上由于网络时延，协议对串联数有严格规定。如采用粗同轴电缆的 10BASE5 以太网规范中，互相串联的中继器个数不能超过四个，而且五段通信介质中只有三段可以挂连计算机，其余两段只能用于拓展通信范围的链路段，不能挂连计算机，这就是**“5-4-3规则”**。

### 集线器
集线器（Hub）即多端口的中继器，若多端口同时有输入则会发生冲突。它也工作在物理层，它只起到信号放大和转发作用，不具备信号定向传送能力，是一个标准的共享式设备。

Hub 主要使用双绞线组建共享网络，直接与交换机相连，其组网灵活，但在逻辑上还是一个总线网，同时只能在半双工下工作，因此网络吞吐率受到限制。